<!DOCTYPE html>
<html>
<head>
  <style>
  body{  margin: 32px;font-family: Arial, Helvetica, sans-serif;}

  input, pre{
    background:#ddd;
    padding: 16px;
  }

  #lookup tr td:nth-child(2), #lookup th:nth-child(2),
  #lookup tr td:nth-child(3), #lookup th:nth-child(3),
  #lookup tr td:nth-child(4), #lookup th:nth-child(4)
  {
    display: none;
  }

</style>
<body>
  <h1>BBC BASIC VDU string generator</h1>
  <p>This page takes a comma separated list of numbers and returns a string that can be tweeted to <a href="https://www.bbcmicrobot.com">BBCMicroBot</a>. You can find <a href="https://github.com/8bitkick/8bitkick.github.io/tree/master/vdu">source for this page</a> on Github</p>
  <h2>Enter VDU code</h2>
  <input id="code" size="100"></input>
  <h2>PRINT string equivalent</h2>
  <pre id="output"></pre>
  <a href="" id="owlet" target="_blank">Open this code on bbcmic.ro</a>

  <h2>VDU code summary</h2>
  <a href="https://central.kaserver5.org/Kasoft/Typeset/BBC/Ch34.html">Source: https://central.kaserver5.org/Kasoft/Typeset/BBC/Ch34.html</a>
  <p></p><table id="lookup" border="1">
    <tr><th align="left" width="12"><strong><tt>Decimal</tt></strong>
    </th><th width="16"><strong><tt>Hex</tt></strong>
    </th><th width="7"><strong><tt>CTRL</tt></strong>
    </th><th width="25"><strong><tt>ASCII abbrev.</tt></strong>
    </th><th width="7"><strong><tt>Bytes extra</tt></strong>
    </th><th width="200"><strong><tt>Meaning</tt></strong>
    </th></tr><tr><td>0
    </td><td>0
    </td><td>@
    </td><td>NUL
    </td><td>0
    </td><td>does nothing
    </td></tr><tr><td>1
    </td><td>1
    </td><td>A
    </td><td>SOH
    </td><td>1
    </td><td>send next character to printer only
    </td></tr><tr><td>2
    </td><td>2
    </td><td>B
    </td><td>STX
    </td><td>0
    </td><td>enable printer
    </td></tr><tr><td>3
    </td><td>3
    </td><td>C
    </td><td>ETX
    </td><td>0
    </td><td>disable printer
    </td></tr><tr><td>4
    </td><td>4
    </td><td>D
    </td><td>EOT
    </td><td>0
    </td><td>write text at text cursor
    </td></tr><tr><td>5
    </td><td>5
    </td><td>E
    </td><td>ENQ
    </td><td>0
    </td><td>write text at graphics cursor
    </td></tr><tr><td>6
    </td><td>6
    </td><td>F
    </td><td>ACK
    </td><td>0
    </td><td>enable VDU drivers
    </td></tr><tr><td>7
    </td><td>7
    </td><td>G
    </td><td>BEL
    </td><td>0
    </td><td>make a short beep
    </td></tr><tr><td>8
    </td><td>8
    </td><td>H
    </td><td>BS
    </td><td>0
    </td><td>backspace cursor one character
    </td></tr><tr><td>9
    </td><td>9
    </td><td>I
    </td><td>HT
    </td><td>0
    </td><td>forwardspace cursor one character
    </td></tr><tr><td>10
    </td><td>A
    </td><td>J
    </td><td>LF
    </td><td>0
    </td><td>move cursor down one line
    </td></tr><tr><td>11
    </td><td>B
    </td><td>K
    </td><td>VT
    </td><td>0
    </td><td>move cursor up one line
    </td></tr><tr><td>12
    </td><td>C
    </td><td>L
    </td><td>FF
    </td><td>0
    </td><td>clear text area
    </td></tr><tr><td>13
    </td><td>D
    </td><td>M
    </td><td>CR
    </td><td>0
    </td><td>move cursor to start of current line
    </td></tr><tr><td>14
    </td><td>E
    </td><td>N
    </td><td>SO
    </td><td>0
    </td><td>page mode on
    </td></tr><tr><td>15
    </td><td>F
    </td><td>O
    </td><td>SI
    </td><td>0
    </td><td>page mode off
    </td></tr><tr><td>16
    </td><td>10
    </td><td>P
    </td><td>DLE
    </td><td>0
    </td><td>clear graphics area
    </td></tr><tr><td>17
    </td><td>11
    </td><td>Q
    </td><td>DC1
    </td><td>1
    </td><td>define text colour
    </td></tr><tr><td>18
    </td><td>12
    </td><td>R
    </td><td>DC2
    </td><td>2
    </td><td>define graphics colour
    </td></tr><tr><td>19
    </td><td>13
    </td><td>S
    </td><td>DC3
    </td><td>5
    </td><td>define logical colour
    </td></tr><tr><td>20
    </td><td>14
    </td><td>T
    </td><td>DC4
    </td><td>0
    </td><td>restore default logical colours
    </td></tr><tr><td>21
    </td><td>15
    </td><td>U
    </td><td>NAK
    </td><td>0
    </td><td>disable VDU drivers or delete current line
    </td></tr><tr><td>22
    </td><td>16
    </td><td>V
    </td><td>SYN
    </td><td>1
    </td><td>select screen mode
    </td></tr><tr><td>23
    </td><td>17
    </td><td>W
    </td><td>ETB
    </td><td>9
    </td><td>re-program display character
    </td></tr><tr><td>24
    </td><td>18
    </td><td>X
    </td><td>CAN
    </td><td>8
    </td><td>define graphics window
    </td></tr><tr><td>25
    </td><td>19
    </td><td>Y
    </td><td>EM
    </td><td>5
    </td><td><strong>PLOT K,x,y</strong>
    </td></tr><tr><td>26
    </td><td>1A
    </td><td>Z
    </td><td>SUB
    </td><td>0
    </td><td>restore default windows
    </td></tr><tr><td>27
    </td><td>1B
    </td><td>[
    </td><td>ESC
    </td><td>0
    </td><td>does nothing
    </td></tr><tr><td>28
    </td><td>1C
    </td><td>\
    </td><td>FS
    </td><td>4
    </td><td>define text window
    </td></tr><tr><td>29
    </td><td>1D
    </td><td>]
    </td><td>GS
    </td><td>4
    </td><td>define graphics origin
    </td></tr><tr><td>30
    </td><td>1E
    </td><td>^
    </td><td>RS
    </td><td>0
    </td><td>home text cursor to top left
    </td></tr><tr><td>31
    </td><td>1F
    </td><td>_
    </td><td>US
    </td><td>2
    </td><td>move text cursor to x,y
    </td></tr><tr><td>127
    </td><td>7F
    </td><td><em>none</em>
    </td><td>DEL
    </td><td>0
    </td><td>Backspace and delete
    </td></tr></table>
    <script>
    // Javascript code to generate BBC BASIC VDU strings
    // Based on https://gist.github.com/pmalin/6928c11309c8c92c5372f7f8c3fc3cc2

    let vdu= [
      17,131, // COLOUR 131
      12, // CLS
      19, 3, 7, 0, 0, 0, // Set palette COL 3=7 (white)
      19, 2, 6, 0, 0, 0, // Set palette COL 2=6 (cyan)
      19, 1, 4, 0, 0, 0, // Set palette COL 1=4 (blue)
      5, // graphics text, cursor off
      29, // Set graphics origin
      640,512 // Coordinates
    ];

    let out = "";

    function safeChar(n){
      return String.fromCharCode((n < 32 || n > 126) ? n+256 : n);
    }

    function processNumber(n){
      n = parseInt(n,10)
      if (n==13) {out += '[WARN: 13 cannot be encoded]';}
      if (n==34) {out += safeChar(n);} // escape "
      out += safeChar(n);
    }

    function splitWords(n){
      if (n<256) return n;
      return `${n & 0xFF},${n >> 8}`;
    }

    function updateHTML(){
      let prog = encodeURI(JSON.stringify({v:1,program:'MODE1\nPRINT"'+out+'"'}));
      document.getElementById("code").innerHTML="VDU "+vdu.join(',');
      document.getElementById("output").innerHTML=`PRINT"${out}"`;
      document.getElementById("owlet").setAttribute("href","https://bbcmic.ro/#"+prog);
    }

    function main(e){
      out ="";
      let vdu = document.getElementById("code").value.split(",");
      console.log(vdu)
      vdu = vdu.map(splitWords).join(",").split(",");
      console.log(vdu)
      vdu.forEach(k => {processNumber(k)});
      updateHTML();
    }

    document.getElementById("code").addEventListener("keyup", main);

    </script>
  </body>
  </html>
